<mxfile host="app.diagrams.net" modified="2025-10-26T05:41:48.875Z" agent="drawio" version="24.0.0" type="device">
  <diagram name="Infrastructure" id="infrastructure">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Hono Lambda POC - インフラ構成図" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="320" y="20" width="530" height="40" as="geometry" />
        </mxCell>

        <!-- CI/CD Stack Group -->
        <mxCell id="cicd-group" value="CI/CDスタック (cfn-repository.yml)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;verticalAlign=top;align=left;spacingLeft=10;fontSize=14;fontStyle=1;dashed=1;dashPattern=8 8;" vertex="1" parent="1">
          <mxGeometry x="60" y="100" width="480" height="300" as="geometry" />
        </mxCell>

        <!-- GitHub Actions -->
        <mxCell id="github-actions" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#759C3E;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.generic;" vertex="1" parent="1">
          <mxGeometry x="100" y="150" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="github-actions-label" value="GitHub Actions" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="80" y="215" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- GitHub OIDC Provider -->
        <mxCell id="oidc-provider" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#DD344C;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.identity_and_access_management;" vertex="1" parent="1">
          <mxGeometry x="250" y="150" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oidc-provider-label" value="GitHub&#xa;OIDCプロバイダー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="230" y="215" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- IAM Role for GitHub Actions -->
        <mxCell id="gha-role" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#DD344C;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.role;" vertex="1" parent="1">
          <mxGeometry x="250" y="280" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="gha-role-label" value="GitHub Actions&#xa;IAMロール" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="230" y="345" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- ECR Repository -->
        <mxCell id="ecr" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#ED7100;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;" vertex="1" parent="1">
          <mxGeometry x="420" y="150" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ecr-label" value="ECR&#xa;リポジトリ" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="400" y="215" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- Application Stack Group -->
        <mxCell id="app-group" value="アプリケーションスタック (cfn-service.yml)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#F57C00;verticalAlign=top;align=left;spacingLeft=10;fontSize=14;fontStyle=1;dashed=1;dashPattern=8 8;" vertex="1" parent="1">
          <mxGeometry x="630" y="100" width="480" height="500" as="geometry" />
        </mxCell>

        <!-- API Gateway -->
        <mxCell id="apigateway" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#E7157B;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;" vertex="1" parent="1">
          <mxGeometry x="840" y="150" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="apigateway-label" value="API Gateway&#xa;HTTP API" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="215" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- Lambda Function -->
        <mxCell id="lambda" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#ED7100;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.lambda;" vertex="1" parent="1">
          <mxGeometry x="840" y="320" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lambda-label" value="Lambda関数&#xa;(ARM64, コンテナ)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="810" y="385" width="120" height="30" as="geometry" />
        </mxCell>

        <!-- Lambda Execution Role -->
        <mxCell id="lambda-role" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#DD344C;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.role;" vertex="1" parent="1">
          <mxGeometry x="840" y="480" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="lambda-role-label" value="Lambda&#xa;実行ロール" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="545" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- CloudWatch Logs -->
        <mxCell id="cloudwatch" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#E7157B;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudwatch;" vertex="1" parent="1">
          <mxGeometry x="1000" y="480" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="cloudwatch-label" value="CloudWatch&#xa;ログ" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="980" y="545" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- User/Client -->
        <mxCell id="user" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#232F3E;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;shape=mxgraph.aws4.user;" vertex="1" parent="1">
          <mxGeometry x="660" y="150" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="user-label" value="ユーザー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="640" y="215" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- Arrows and Connections -->
        
        <!-- GitHub Actions to OIDC -->
        <mxCell id="arrow-gha-oidc" value="認証" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="1" source="github-actions" target="oidc-provider">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- OIDC to Role -->
        <mxCell id="arrow-oidc-role" value="ロール取得" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="1" source="oidc-provider" target="gha-role">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Role to ECR -->
        <mxCell id="arrow-role-ecr" value="イメージプッシュ" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#1976D2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="gha-role" target="ecr">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="310" />
              <mxPoint x="360" y="195" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Role to Lambda (Update) -->
        <mxCell id="arrow-role-lambda" value="関数更新" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#1976D2;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="gha-role" target="lambda">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="550" y="310" />
              <mxPoint x="550" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ECR to Lambda -->
        <mxCell id="arrow-ecr-lambda" value="イメージ取得" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F57C00;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="ecr" target="lambda">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="180" />
              <mxPoint x="580" y="290" />
              <mxPoint x="870" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- User to API Gateway -->
        <mxCell id="arrow-user-apigw" value="HTTPSリクエスト" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F57C00;" edge="1" parent="1" source="user" target="apigateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- API Gateway to Lambda -->
        <mxCell id="arrow-apigw-lambda" value="起動" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F57C00;" edge="1" parent="1" source="apigateway" target="lambda">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Lambda to Lambda Role -->
        <mxCell id="arrow-lambda-role" value="ロール取得" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F57C00;" edge="1" parent="1" source="lambda" target="lambda-role">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Lambda to CloudWatch -->
        <mxCell id="arrow-lambda-cw" value="ログ出力" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F57C00;" edge="1" parent="1" source="lambda" target="cloudwatch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#9E9E9E;" vertex="1" parent="1">
          <mxGeometry x="60" y="450" width="480" height="150" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="凡例" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="460" width="100" height="30" as="geometry" />
        </mxCell>
        
        <!-- CI/CD Flow Legend -->
        <mxCell id="legend-cicd-line" value="" style="shape=line;strokeWidth=3;strokeColor=#1976D2;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="505" width="60" height="10" as="geometry" />
        </mxCell>
        <mxCell id="legend-cicd-text" value="CI/CDフロー (GitHub Actions → ECR → Lambda)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="150" y="495" width="350" height="30" as="geometry" />
        </mxCell>

        <!-- Application Flow Legend -->
        <mxCell id="legend-app-line" value="" style="shape=line;strokeWidth=3;strokeColor=#F57C00;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="545" width="60" height="10" as="geometry" />
        </mxCell>
        <mxCell id="legend-app-text" value="アプリケーションフロー (ユーザー → API Gateway → Lambda)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="150" y="535" width="380" height="30" as="geometry" />
        </mxCell>

        <!-- Notes -->
        <mxCell id="notes-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#F9A825;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="630" y="650" width="480" height="130" as="geometry" />
        </mxCell>
        <mxCell id="notes-title" value="備考" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="650" y="660" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="notes-text" value="• LambdaはARM64アーキテクチャで動作し、ECRのコンテナイメージを使用&#xa;• API GatewayはHTTP API（REST APIではない）を使用し、$defaultステージで動作&#xa;• GitHub ActionsはOIDC経由で認証（長期的な認証情報不要）&#xa;• ECRライフサイクルポリシーにより最新5イメージのみ保持&#xa;• Lambdaのタイムアウトは30秒、メモリは512MB" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacing=5;" vertex="1" parent="1">
          <mxGeometry x="650" y="690" width="440" height="80" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
